<!DOCTYPE html>
<html>
<head>
<title>Перетаскиваемые Div-ы</title>
<style>
.draggable-div {
  width: 200px;
  height: 100px;
  border: 1px solid #ccc;
  margin-bottom: 10px;
  padding: 10px;
  background-color: #f9f9f9;
  cursor: grab; /* Меняем курсор на "grab" */
}

.draggable-div.active {
  background-color: #e0e0e0; /* Выделяем активный div */
}

.drag-over {
  border-top: 4px dashed blue; /* Черта сверху */
}
</style>
</head>
<body>

<div id="container">
  <div id="div1" class="draggable-div" draggable="true">Div 1</div>
  <div id="div2" class="draggable-div" draggable="true">Div 2</div>
  <div id="div3" class="draggable-div" draggable="true">Div 3</div>
  <div id="div4" class="draggable-div" draggable="true">Div 4</div>
  <div id="div5" class="draggable-div" draggable="true">Div 5</div>
</div>

<script>
const container = document.getElementById('container');
let draggedElement = null; // Переменная для хранения перетаскиваемого элемента

// Функция для добавления класса
function addClass(element, className) {
    if (!element.classList.contains(className)) {
        element.classList.add(className);
    }
}

// Функция для удаления класса
function removeClass(element, className) {
    element.classList.remove(className);
}

// Обработчик начала перетаскивания
function handleDragStart(event) {
  draggedElement = event.target; // Запоминаем перетаскиваемый элемент
  addClass(draggedElement, 'active'); // Делаем его активным
  event.dataTransfer.setData('text/plain', event.target.id); // Передаем ID элемента
}

// Обработчик окончания перетаскивания
function handleDragEnd(event) {
  removeClass(draggedElement, 'active'); // Убираем активное состояние
  draggedElement = null; // Сбрасываем переменную
  // Убираем все черты, если они остались
  document.querySelectorAll('.drag-over').forEach(element => {
    removeClass(element, 'drag-over');
  });
}

// Обработчик наведения (dragover)
function handleDragOver(event) {
  event.preventDefault(); // Разрешаем drop
}

// Обработчик входа в область (dragenter)
function handleDragEnter(event) {
  if (event.target !== draggedElement && event.target.classList.contains('draggable-div')) {
    addClass(event.target, 'drag-over'); // Добавляем черту
  }
}

// Обработчик выхода из области (dragleave)
function handleDragLeave(event) {
  if (event.target !== draggedElement && event.target.classList.contains('draggable-div')) {
    removeClass(event.target, 'drag-over'); // Убираем черту
  }
}

// Обработчик drop (отпускание элемента)
function handleDrop(event) {
  event.preventDefault(); // Предотвращаем стандартное поведение

  const target = event.target;

  if (target.classList.contains('draggable-div') && target !== draggedElement) {
    removeClass(target, 'drag-over'); // Убираем черту

    // Определяем, куда вставить элемент (до или после)
    const rect = target.getBoundingClientRect();
    const mouseY = event.clientY;

    if (mouseY < rect.top + rect.height / 2) {
      // Вставляем перед элементом
      container.insertBefore(draggedElement, target);
    } else {
      // Вставляем после элемента
      container.insertBefore(draggedElement, target.nextSibling);
    }
  }
}


// Добавляем обработчики событий ко всем div-ам
const divs = document.querySelectorAll('.draggable-div');
divs.forEach(div => {
  div.addEventListener('dragstart', handleDragStart);
  div.addEventListener('dragend', handleDragEnd);
  div.addEventListener('dragover', handleDragOver);
  div.addEventListener('dragenter', handleDragEnter);
  div.addEventListener('dragleave', handleDragLeave);
  div.addEventListener('drop', handleDrop);
});
</script>

</body>
</html>