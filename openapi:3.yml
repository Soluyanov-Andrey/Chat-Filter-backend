openapi: 3.0.0
info:
  title: API для сканера
  version: 1.0.1
  description: |
    API для управления сервисом
  
servers:
  - url: http://localhost:3000 # Замените на реальный URL вашего сервера
    description: Локальный сервер разработки
paths:
  /folder-structure:
    get:
      summary: Возвращает структуру папок в виде JSON
      description: Возвращает структуру папок (и файлов) в указанном каталоге в виде JSON.
      parameters:
        - in: query
          name: path
          schema:
            type: string
          required: true
          description: Абсолютный или относительный путь к папке.
      responses:
        '200':
          description: Успешный запрос. Возвращает структуру папок в виде JSON.
          content:
            application/json:
              schema:
                type: object
                properties:
                  folders:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Название папки или файла
                        type:
                          type: string
                          description: Тип элемента (folder+ для папок с подпапками, folder для обычных папок)
                      required:
                        - name
                        - type
              example:
                folders:
                  - name: "папка1"
                    type: "folder+"
                  - name: "папка2"
                    type: "folder"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Папка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Folder not found"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /delete-list:
    get:
      summary: Удаляем тему по ID
      description: Удаляем тему по ID
      parameters:
        - in: query
          name: id
          schema:
            type: integer
            format: int64 #  (или int32, в зависимости от диапазона ваших ID)
            description: Идентификатор папки (должен быть числом).
            example: 123
          required: true
      responses:
        '200':
          description: Папка успешно открыта.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Folder open"
                example:
                  {
                    "status": "success",
                    "message": "Folder open"
                  }
        '500': # Ошибка на сервере (например, не удалось создать папку из-за проблем с файловой системой)
          $ref: '#/components/responses/InternalServerError'




  /create-folder:
    post:
      summary: Создает новую папку
      description: Создает новую папку по указанному пути.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: string
                  description: Абсолютный или относительный путь к новой папке.
                  example: "/путь/к/новой/папке"
              required:
                - path
      responses:
        '201':
          description: Папка успешно создана.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Folder created successfully"
                example:
                  {
                    "status": "success",
                    "message": "Folder created successfully"
                  }
        '500':
          $ref: '#/components/responses/InternalServerError'

  /open-folder:
    get:  
      summary: Открыть папку 
      description: Если папка содержит document папку внутри то читаем содержание в ней файлов и выводим
      parameters:
        - in: query
          name: path
          schema:
            type: string
          required: true
          description: Абсолютный или относительный путь к новой папке.
      responses:
        '200':
          description: Папка успешно открыта для анализа.
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Название элемента
                      required:
                        - name
              example:
                page: [
                  {
                    "name": "папка1"
                  },
                  {
                    "name": "папка2"
                  }
                ]
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Папка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Folder not found"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /scan:
    get:  
      summary: Сканируем документ
      description: Сканируем документ в конкретной папки и выводим в форме li
      responses:
        '200': # Успешное открытие папки
          description: Папка успешно открыта для анализа.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Folder open"
                example:
                  {
                    "status": "success",
                    "message": "Folder open"
                  }

  /create_topic:
    post:
      summary: Создает новую тему
      description: Создает новую тему на страницу
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                  format: int64 # Или int32
                  description: Идентификатор новой страницы.
                  example: 123
                path:
                  type: string
                  description: Абсолютный или относительный путь к новой странице.
                  example: "/путь/к/новой/странице"
              required:
                - id
                - path
      responses:
        '201':
          description: Тема успешно создана.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Folder created successfully"
                example:
                  {
                    "status": "success",
                    "message": "Folder open"
                  }
        '500':
          $ref: '#/components/responses/InternalServerError'

  /delete_select:
    post:
      summary: Удаляет выбранные элементы
      description: Удаляет все элементы, отмеченные галочками
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                selectedItems:
                  type: array
                  items:
                    type: string
                  description: Массив идентификаторов выбранных элементов
              required:
                - selectedItems
      responses:
        '200':
          description: Элементы успешно удалены
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  deletedCount:
                    type: integer
                    description: Количество удаленных элементов
              example:
                status: "success"
                message: "Items deleted successfully"
                deletedCount: 5
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Один или несколько элементов не найдены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Some items were not found"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /leave_selected:
    post:
      summary: Оставляет только выбранные элементы
      description: Удаляет все элементы кроме тех, что отмечены галочками
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                selectedItems:
                  type: array
                  items:
                    type: string
                  description: Массив идентификаторов элементов, которые нужно оставить
              required:
                - selectedItems
      responses:
        '200':
          description: Операция выполнена успешно
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  remainingCount:
                    type: integer
                    description: Количество оставшихся элементов
              example:
                status: "success"
                message: "Operation completed successfully"
                remainingCount: 3
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Один или несколько элементов не найдены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Some items were not found"
        '500':
          $ref: '#/components/responses/InternalServerError'


  /create-page:
    post:  
      summary: Создает страницу
      description: Создает папку в выбранном пути, копируя содержимое по шаблону
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: string
                  description: Абсолютный или относительный путь к новой папке
                template:
                  type: string
                  description: Идентификатор шаблона для копирования (опционально)
              required:
                - path
      responses:
        '201':
          description: Страница успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  pageId:
                    type: string
                    description: Идентификатор созданной страницы
              example:
                status: "success"
                message: "Page created successfully"
                pageId: "page_123"
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Страница уже существует
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Page already exists at this path"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /view-page:
    get:
      summary: Просмотр содержимого страницы
      description: Получение содержимого страницы по её идентификатору
      parameters:
        - in: query
          name: id
          schema:
            type: string
          required: true
          description: Идентификатор страницы
      responses:
        '200':
          description: Содержимое страницы успешно получено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  content:
                    type: object
                    properties:
                      title:
                        type: string
                      sections:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            content:
                              type: string
                            type:
                              type: string
                              enum: [text, image, code]
                  metadata:
                    type: object
                    properties:
                      created:
                        type: string
                        format: date-time
                      modified:
                        type: string
                        format: date-time
              example:
                status: "success"
                content: {
                  title: "Sample Page",
                  sections: [
                    {
                      id: "section_1",
                      content: "Sample content",
                      type: "text"
                    }
                  ]
                }
                metadata: {
                  created: "2024-03-20T10:00:00Z",
                  modified: "2024-03-20T10:00:00Z"
                }
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Страница не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Page not found"
        '500':
          $ref: '#/components/responses/InternalServerError'


components:
  schemas:

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Сообщение об ошибке.
          example: "Something went wrong"
      required:
        - error
  responses:  # Многократно используемые ответы
    BadRequest:
      description: Некорректный запрос.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            {
              "error": "Invalid request"
            }
    Forbidden:
      description: Доступ запрещен.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            {
              "error": "Access denied"
            }
    InternalServerError:
      description: Ошибка на сервере.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            {
              "error": "Internal server error"
            }